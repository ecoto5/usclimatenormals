-- To download the data. 
$ wget https://github.com/ecoto5/usclimatenormals/raw/main/us_normals.zip

--Unzip the file
$ unzip us_normals.zip

--Creating a new directory
$ hdfs dfs -mkdir ClimateNormals
$ hdfs dfs -mkdir ClimateNormals/data

--Moving the file
$ hdfs dfs -put us_normals.csv ClimateNormals/data

-- Create a table
DROP TABLE IF EXISTS usclimatenormals;
create external table if not exists usclimatenormals (STATION string, MonthDay string, 
LATITUDE double, 
LONGITUDE double, 
ELEVATION double, 
CITY string, 
STATE string, 
month int, 
day int, 
hr int, 
DLY_TAVG double, 
mflag1 string, 
cflag1 string, 
years_DLY_TAVG double,
DLY_TMAX double, 
mflag2 string, 
cflag2 string,
years_DLY_TMAX double,
DLY_TMIN double,
mflag3 string,
cflag3 string,
years_DLY_TMIN double,
DLY_DUTR double,
mflag4 string,
cflag4 string,
years_DLY_DUTR double,
DLY_TAVG_STDDEV double,
mflag5 string,
cflag5 string,
years_DLY_TAVG_STDDEV double,
DLY_TMAX_STDDEV double,
mflag6 string,
cflag6 string,
years_DLY_TMAX_STDDEV double,
DLY_TMIN_STDDEV double,
mflag7  string,
cflag7 string,
years_DLY_TMIN_STDDEV double,
DLY_DUTR_STDDEV double,
mflag8 string,
cflag8 string,
years_DLY_DUTR_STDDEV double,
DLY_HTDD double,
mflag9 string,
cflag9 string,
years_DLY_HTDD double,
DLY_HTDD_BASE40 double,
mflag10 string,
cflag10 string,
years_DLY_HTDD_BASE40 double,
DLY_HTDD_BASE45 double,
mflag11 string,
cflag11 string,
years_DLY_HTDD_BASE45 double,
DLY_HTDD_BASE50 double,
mflag12 string,
cflag12 string,
years_DLY_HTDD_BASE50 double,
DLY_HTDD_BASE55 double,
mflag13 string,
cflag13 string,
years_DLY_HTDD_BASE55 double,
DLY_HTDD_BASE57 double,
mflag14 string,
cflag14 string,
years_DLY_HTDD_BASE57 double,
DLY_HTDD_BASE60 double,
mflag15 string,
cflag15 string,
years_DLY_HTDD_BASE60 double,
DLY_CLDD double,
mflag16 string,
cflag16 string,
years_DLY_CLDD double,
DLY_CLDD_BASE40 double,
mflag17 string,
cflag17 string,
years_DLY_CLDD_BASE40 double,
DLY_CLDD_BASE45 double,
mflag18 string,
cflag18 string,
years_DLY_CLDD_BASE45 double,
DLY_CLDD_BASE50 double,
mflag19 string,
cflag19 string,
years_DLY_CLDD_BASE50 double,
DLY_CLDD_BASE55 double,
mflag20 string,
cflag20 string,
years_DLY_CLDD_BASE55 double,
DLY_CLDD_BASE57 double,
mflag21 string,
cflag21 string,
years_DLY_CLDD_BASE57 double,
DLY_CLDD_BASE60 double,
mflag22 string,
cflag22 string,
years_DLY_CLDD_BASE60 double,
DLY_CLDD_BASE70 double,
mflag23 string,
cflag23 string,
years_DLY_CLDD_BASE70 double,
DLY_CLDD_BASE72 double,
mflag23 string,
cflag23 string,
years_DLY_CLDD_BASE72 double,
DLY_GRDD_BASE65 double,
mflag24 string,
cflag24 string,
years_DLY_GRDD_BASE65 double,
DLY_GRDD_BASE40 double,
mflag25 string,
cflag25 string,
years_DLY_GRDD_BASE40 double,
DLY_GRDD_BASE45 double,
mflag26 string,
cflag27 string,
years_DLY_GRDD_BASE45 double,
DLY_GRDD_BASE50 double,
mflag28 string,
cflag28 string,
years_DLY_GRDD_BASE50 double,
DLY_GRDD_BASE55 double,
mflag29 string,
cflag29 string,
years_DLY_GRDD_BASE55 double,
DLY_GRDD_BASE57 double,
mflag30string,
cflag30 string,
years_DLY_GRDD_BASE57 double,
DLY_GRDD_BASE60 double,
mflag31 string,
cflag31 string,
years_DLY_GRDD_BASE60 double,
DLY_GRDD_BASE70 double,
mflag32 string,
cflag32 string,
years_DLY_GRDD_BASE70 double,
DLY_GRDD_BASE72 double,
mflag33 string,
cflag33 string,
years_DLY_GRDD_BASE72 double,
DLY_GRDD_TB4886 double,
mflag34 string,
cflag34 string,
years_DLY_GRDD_TB4886 double,
DLY_GRDD_TB5086 double,
mflag35 string,
cflag35 string,
years_DLY_GRDD_TB5086 double,
DLY_PRCP_PCTALL_GE001HI double,
mflag36 string,
cflag36 string,
years_DLY_PRCP_PCTALL_GE001HI double,
DLY_PRCP_PCTALL_GE010HI double,
mflag37 string,
cflag37 string,
years_DLY_PRCP_PCTALL_GE010HI double,
DLY_PRCP_PCTALL_GE025HI double,
mflag38 string,
cflag38 string,
years_DLY_PRCP_PCTALL_GE025HI double,
DLY_PRCP_PCTALL_GE050HI double,
mflag39 string,
cflag39 string,
years_DLY_PRCP_PCTALL_GE050HI double,
DLY_PRCP_PCTALL_GE100HI double,
mflag40 string,
cflag40 string,
years_DLY_PRCP_PCTALL_GE100HI double,
DLY_PRCP_PCTALL_GE200HI double,
mflag41 string,
cflag41 string,
years_DLY_PRCP_PCTALL_GE200HI double,
DLY_PRCP_PCTALL_GE400HI double,
mflag42 string,
cflag42 string,
years_DLY_PRCP_PCTALL_GE400HI double,
DLY_PRCP_PCTALL_GE600HI double,
mflag43 string,
cflag43 string,
years_DLY_PRCP_PCTALL_GE600HI double,
DLY_PRCP_25PCTL double,
mflag44 string,
cflag44 string,
years_DLY_PRCP_25PCTL double,
DLY_PRCP_50PCTL double,
mflag45 string,
cflag45 string,
years_DLY_PRCP_50PCTL double,
DLY_PRCP_75PCTL double,
mflag46 string,
cflag46 string,
years_DLY_PRCP_75PCTL double,
MTD_PRCP double,
mflag47 string,
cflag47 string,
years_MTD_PRCP double,
YTD_PRCP double,
mflag48 string,
cflag48 string,
years_YTD_PRCP double,
DLY_SNOW_PCTALL_GE001TI double,
mflag49 string,
cflag49 string,
years_DLY_SNOW_PCTALL_GE001TI double,
DLY_SNOW_PCTALL_GE010TI double, 
mflag50 string,
cflag50 string,
years_DLY_SNOW_PCTALL_GE010TI double,
DLY_SNOW_PCTALL_GE020TI double,
mflag51 string,
cflag51 string,
years_DLY_SNOW_PCTALL_GE020TI double,
DLY_SNOW_PCTALL_GE030TI double,
mflag52 string,
cflag52 string,
years_DLY_SNOW_PCTALL_GE030TI double,
DLY_SNOW_PCTALL_GE040TI double,
mflag53 string,
cflag53 string,
years_DLY_SNOW_PCTALL_GE040TI double,
DLY_SNOW_PCTALL_GE050TI double,
mflag54 string,
cflag54 string,
years_DLY_SNOW_PCTALL_GE050TI double,
DLY_SNOW_PCTALL_GE100TI double,
mflag55 string,
cflag55 string,
years_DLY_SNOW_PCTALL_GE100TI double,
DLY_SNOW_PCTALL_GE200TI double,
mflag56 string,
cflag56 string,
years_DLY_SNOW_PCTALL_GE200TI double,
MTD_SNOW double,
mflag57 string,
cflag57 string,
years_MTD_SNOW double,
YTD_SNOW double,
mflag58 string,
cflag58 string,
years_YTD_SNOW double,
DLY_SNWD_PCTALL_GE001WI double,
mflag59 string,
cflag59 string,
years_DLY_SNWD_PCTALL_GE001WI double,
DLY_SNWD_PCTALL_GE002WI double,
mflag60 string,
cflag60 string,
years_DLY_SNWD_PCTALL_GE002WI double,
DLY_SNWD_PCTALL_GE003WI double,
mflag61 string,
cflag61 string,
years_DLY_SNWD_PCTALL_GE003WI double,
DLY_SNWD_PCTALL_GE004WI double,
mflag62 string,
cflag62 string,
years_DLY_SNWD_PCTALL_GE004WI double,
DLY_SNWD_PCTALL_GE005WI double,
mflag63 string,
cflag63 string,
years_DLY_SNWD_PCTALL_GE005WI double,
DLY_SNWD_PCTALL_GE010WI double,
mflag64 string,
cflag64 string,
years_DLY_SNWD_PCTALL_GE010WI double,
DLY_SNWD_PCTALL_GE020WI double,
mflag65 string,
cflag65 string,
years_DLY_SNWD_PCTALL_GE020W double
)
ROW FORMAT DELIMITED FIELDS TERMINATED BY ','
STORED AS TEXTFILE LOCATION '/user/ecoto5/ClimateNormals/data'
TBLPROPERTIES ('skip.header.line.count'='1');

--Creating a table for just diurnal temperatures
Drop table if exists all_diurnal_ranges;
CREATE TABLE IF NOT EXISTS all_diurnal_ranges
As SELECT city, state, MonthDay, dly_dutr, latitude, longitude
FROM usclimatenormals;

--Create an output file for all states diurnal temperature. 
INSERT OVERWRITE DIRECTORY '/user/yourusername/tmp/'
ROW FORMAT DELIMITED FIELDS TERMINATED BY ','
SELECT * FROM all_diurnal_ranges
WHERE dly_dutr is NOT NULL AND MonthDay='Jul-1'
ORDER BY dly_dutr DESC;

--Creating an output file from the table specifying certain conditions.
INSERT OVERWRITE DIRECTORY '/user/yourusername/tmp/'
ROW FORMAT DELIMITED FIELDS TERMINATED BY ','
SELECT * FROM all_diurnal_ranges
WHERE dly_dutr is NOT NULL AND state='CA US' AND MonthDay='Jul-1'
ORDER BY dly_dutr DESC;


